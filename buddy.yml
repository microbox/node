- pipeline: "branch: master"
  trigger_mode: "SCHEDULED"
  ref_name: "master"
  ref_type: "BRANCH"
  start_date: "2019-06-16T12:02:00.000Z"
  delay: 1440
  run_always: true
  clone_depth: 1
  trigger_condition: "ALWAYS"
  actions:
    - action: "get version"
      type: "BUILD"
      working_directory: "/buddy/node"
      docker_image_name: "library/alpine"
      docker_image_tag: "edge"
      execute_commands:
        - "export NODE_VERSION=$(wget -qO- https://nodejs.org/dist/latest/ | sed -nE 's|.*>node-v(.*)\\.pkg</a>.*|\\1|p')"
      setup_commands:
        - "apk add curl wget bash"
      mount_filesystem_path: "/buddy/node"
      shell: "BASH"
      trigger_condition: "ALWAYS"
    - action: "build image"
      type: "DOCKERFILE"
      login: "${DOCKER_USER}"
      password: "secure!HSGDlaQSxgCzBgYx6G7Tqg=="
      docker_image_tag: "latest,${NODE_VERSION}"
      dockerfile_path: "Dockerfile"
      repository: "${BUDDY_REPO_SLUG}"
      build_args:
        - "NODE_VERSION=${NODE_VERSION}"
      trigger_condition: "ALWAYS"
  variables:
    - key: "BRANCH"
      value: "8"
      id: 169912
      description: ""
    - key: "DOCKER_PASS"
      value: "secure!OjWE3t9GtiJtCXy9BoRKnAaHxKY+97g+ORykIIqm6d4="
      id: 169915
      description: ""
    - key: "DOCKER_USER"
      value: "e2builder"
      id: 169914
      description: ""
    - key: "NODE_VERSION"
      value: "0.0.0"
      id: 169913
      settable: true
      description: ""

- pipeline: "branch: 8"
  trigger_mode: "SCHEDULED"
  ref_name: "8"
  ref_type: "BRANCH"
    start_date: "2019-06-16T12:02:00.000Z"
  delay: 1440
  run_always: true
  clone_depth: 1
  trigger_condition: "ALWAYS"
  actions:
    - action: "get version"
      type: "BUILD"
      working_directory: "/buddy/node"
      docker_image_name: "library/alpine"
      docker_image_tag: "edge"
      execute_commands:
        - "export NODE_VERSION=$(wget -qO- https://nodejs.org/dist/latest-v${BRANCH}.x/ | sed -nE 's|.*>node-v(.*)\\.pkg</a>.*|\\1|p')"
      setup_commands:
        - "apk add curl wget bash"
      mount_filesystem_path: "/buddy/node"
      shell: "BASH"
      trigger_condition: "ALWAYS"
    - action: "build image"
      type: "DOCKERFILE"
      login: "${DOCKER_USER}"
      password: "secure!HSGDlaQSxgCzBgYx6G7Tqg=="
      docker_image_tag: "${BRANCH},${NODE_VERSION}"
      dockerfile_path: "Dockerfile"
      repository: "${BUDDY_REPO_SLUG}"
      build_args:
        - "NODE_VERSION=${NODE_VERSION}"
      trigger_condition: "ALWAYS"
  variables:
    - key: "BRANCH"
      value: "8"
      id: 169912
      description: ""
    - key: "DOCKER_PASS"
      value: "secure!OjWE3t9GtiJtCXy9BoRKnAaHxKY+97g+ORykIIqm6d4="
      id: 169915
      description: ""
    - key: "DOCKER_USER"
      value: "e2builder"
      id: 169914
      description: ""
    - key: "NODE_VERSION"
      value: "0.0.0"
      id: 169913
      settable: true
      description: ""
